#!/usr/bin/env bash

NAME="$1"
VERSION="$2"

if [ -z "$NAME" ] || [ -z "$VERSION" ]; then
  bunvm_msg_error "Usage: bunvm alias <name> <version>"
  return 1
fi

# verify that the version exists
if [ ! -d "$BUNVM_VERSIONS/bun-$VERSION" ]; then
  bunvm_msg_error "Version $VERSION is not installed. Install it before creating the alias."
  return 1
fi

# remove previous alias with the same name
if [ -f "$BUNVM_ETC/aliases" ]; then
  grep -v "^$NAME=" "$BUNVM_ETC/aliases" > "$BUNVM_ETC/aliases.tmp" || true
  mv "$BUNVM_ETC/aliases.tmp" "$BUNVM_ETC/aliases" 2>/dev/null || true
fi

echo "$NAME=$VERSION" >> "$BUNVM_ETC/aliases"

bunvm_msg_success "Alias '$NAME' registered â†’ $VERSION"
