#!/usr/bin/env bash

bunvm_msg "üîÑ Actualizando BunVM‚Ä¶"

# actualizar core
if ! curl -fsSL "https://raw.githubusercontent.com/privjaac/bunvm/main/bunvm.sh" \
  -o "$BUNVM_DIR/bunvm.sh"; then
  bunvm_msg_error "‚ùå No se pudo actualizar bunvm.sh"
  return 1
fi
chmod +x "$BUNVM_DIR/bunvm.sh"

# actualizar comandos
for CMD in install uninstall use list current alias selfupdate; do
  if ! curl -fsSL "https://raw.githubusercontent.com/privjaac/bunvm/main/commands/$CMD" \
    -o "$BUNVM_DIR/commands/$CMD"; then
    bunvm_msg_error "‚ùå No se pudo actualizar comando: $CMD"
    return 1
  fi
  chmod +x "$BUNVM_DIR/commands/$CMD"
done

# actualizar librer√≠as
for LIB in detect_platform fetch_version messages validate; do
  if ! curl -fsSL "https://raw.githubusercontent.com/privjaac/bunvm/main/lib/$LIB" \
    -o "$BUNVM_DIR/lib/$LIB"; then
    bunvm_msg_error "‚ùå No se pudo actualizar librer√≠a: $LIB"
    return 1
  fi
  chmod +x "$BUNVM_DIR/lib/$LIB"
done

# actualizar autoenv
if ! curl -fsSL "https://raw.githubusercontent.com/privjaac/bunvm/main/autoload/autoenv.sh" \
  -o "$BUNVM_DIR/autoload/autoenv.sh"; then
  bunvm_msg_error "‚ùå No se pudo actualizar autoenv.sh"
  return 1
fi
chmod +x "$BUNVM_DIR/autoload/autoenv.sh"

# actualizar autocompletado bash
if ! curl -fsSL "https://raw.githubusercontent.com/privjaac/bunvm/main/autoload/completion.bash" \
  -o "$BUNVM_DIR/autoload/completion.bash"; then
  bunvm_msg_error "‚ùå No se pudo actualizar completion.bash"
  return 1
fi
chmod +x "$BUNVM_DIR/autoload/completion.bash"

# actualizar autocompletado zsh
if ! curl -fsSL "https://raw.githubusercontent.com/privjaac/bunvm/main/autoload/completion.zsh" \
  -o "$BUNVM_DIR/autoload/completion.zsh"; then
  bunvm_msg_error "‚ùå No se pudo actualizar completion.zsh"
  return 1
fi
chmod +x "$BUNVM_DIR/autoload/completion.zsh"

bunvm_msg_success "BunVM actualizado correctamente."
bunvm_msg_info "Recarga tu shell para activar el autocompletado: source ~/.zshrc (o ~/.bashrc)"
